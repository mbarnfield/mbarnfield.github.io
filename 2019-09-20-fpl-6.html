<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Captaincy choice, FPL gameweek 6 2019</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Matthew Barnfield</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="publications.html">Publications</a>
</li>
<li>
  <a href="software.html">Software</a>
</li>
<li>
  <a href="teaching.html">Teaching</a>
</li>
<li>
  <a href="blog.html">Blog</a>
</li>
<li>
  <a href="fpl.html">FPL</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/mbarnfield">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/m_barnfield">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://www.reddit.com/user/pm_me_tidy_code">
    <span class="fa fa-reddit fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Captaincy choice, FPL gameweek 6 2019</h1>
<h4 class="date">September 2019</h4>

</div>


<div id="picking-an-fpl-captain-gameweek-6" class="section level2 unnumbered">
<h2>Picking an FPL captain: Gameweek 6</h2>
<p>Last week, the Bayesian multilevel model I have been working on <a href="https://www.reddit.com/r/FantasyPL/comments/d3facu/captain_selection_gameweek_5_bayesian_multilevel/">rated Mané the most likely to score big</a>. Mané got 15 points, second only to Son. This was partly lucky, obviously, but I think it’s also a reflection of the fact that the logic on which good FPL players base their captaincy picks tends to be pretty sound. And, reminder, all this model seeks to do is represent that logic more formally and probabilistically. Mané, on form, against Newcastle at home? Yes please.</p>
<p>I’m quite chuffed that Mané did well, in line with the model. But, of course, not <em>that</em> many good players own Mané relative to his price, especially when compared to Salah. Only 2% of respondents to the <a href="https://www.strawpoll.me/18633875/r">Reddit captaincy poll</a> picked him, compared to 42% and 36% for Sterling and Salah, respectively. So perhaps it wasn’t that useful a recommendation. Or, at least, it was a curious prediction given that the general thinking seems to be that Salah is a better pick. I had a <a href="https://www.reddit.com/r/FantasyPL/comments/d3facu/captain_selection_gameweek_5_bayesian_multilevel/f02juzx?utm_source=share&amp;utm_medium=web2x">discussion in the comments of the Reddit post</a> about why Mané was predicted to outperform Salah. It seems most likely that it was to do with the data I’m using. To avoid the complications introduced by the January transfer window, I use data <strong>only from gameweek 25, 2018/19</strong> (the first gameweek after the transfer window, I think) onwards. Mané did <em>excellently</em> in this period, with five double-figure gameweeks out of thirteen. Salah, meanwhile, only had one such gameweek, only scoring big (&gt;5) on a few other occasions. What’s more, in that iteration of the model, I wasn’t using weights to downweight last season’s data relative to this season’s. This overall issue also explains why Son wasn’t seen as likely to do well, after a disappointing period in gameweeks 25-38.</p>
</div>
<div id="weights-and-other-changes" class="section level2 unnumbered">
<h2>Weights and other changes</h2>
<p>I am now running the model with a <em>gameweek weighting</em> which essentially assigns exponentially more weight to more recent weeks. This makes it so that last week is weighted approximately 1.5x higher than gameweek 25. What this basically means is that the model treats the data as if last week happened one and a half times, while gameweek 25 only happened once. I do this to capture form. I think it’s quite intuitive. How players are playing recently is more important to whether we decide to captain them than how they played halfway through last season, but not so much so that it should be treated as drastically more significant.</p>
<p>This weighting doesn’t change the Salah-Mané situation, because Mané has outperformed Salah the last couple of gameweeks. But, remember, the point of the model is to help you choose a captain from among <strong>your players</strong>. If you have Salah, but not Mané, Agüero, or Sterling, it’s telling you to captain Salah. It just thinks that, based on ‘form’, general FPL performance, the fixture, and the assumption that all players play the same minutes as last week (more on that in a sec), Mané is more likely to score higher. It’s still not convinvced by Son, though. He’ll get up there with time.</p>
<p>Another, minor change I have made is introducing multiple membership. Before, although players such as Iwobi had one team before this season and another this season (from Arsenal to Everton), I didn’t treat these players as being members of more than one group. I’m not entirely sure on the implications of this for estimation, as I’ve not read up on it, but it’s clearly a misrepresentation of the data. Each player now has a <code>team_1</code> variable and a <code>team_2</code> variable, and the model formula specifies that they are members of both of these. The influence of these is currently weighted equally, as I’ve not decided on a theoretical reason to change this.</p>
<p>The most impactful change I have made, though, is reintroducing the <code>minutes</code> variable. I discussed the problems not having this as a predictor was causing last week, prompted by <a href="https://www.reddit.com/r/FantasyPL/comments/d3facu/captain_selection_gameweek_5_bayesian_multilevel/f029r8d?utm_source=share&amp;utm_medium=web2x">a Reddit comment about KDB</a>. Essentially, the model couldn’t recognise the reason that these players had a lot of 0s was because they had been injured, and therefore also having 0 minutes. So it thought the reason they had performed so badly was to do with the other predictors (who they are, who they play against, who they play for, whether they’re home or away — you know the drill). I dropped this variable by mistake when recoding and wrangling last season’s data (from <a href="https://github.com/vaastav/Fantasy-Premier-League">vaastav’s amazing repo</a>). I was dreading reintroducing it, because I knew it would mean a lot of manual coding. I just couldn’t see a way to automate the process — or, at least, not one that wouldn’t just take me longer to think through and write than the manual process would take anyway. If you’re interested in what I ended up doing, look at the <a href="https://github.com/mbarnfield/fpl_captain/blob/master/add_mins.R"><code>add_mins</code> file on my Github</a>. It was long, but not as bad as I thought. This sort of thing is bad data science practice, because it’s so prone to errors. But come on, I know we sometimes think FPL is all there is, but I don’t think the world will end if a few players are deemed to have played the wrong amount of minutes a few times. And, for what it’s worth, I’ve done multiple random checks of the data and not found any mistakes yet. I’ll keep an eye on it.</p>
<p>The way I implement this variable in the prediction stage is by assuming every player plays the same amount of minutes as last week. It doesn’t make sense to assume everyone plays 90, for obvious reasons (and when you do this Laporte, for example, is in the top ten, despite being injured). It’s equally dodgy to make my own assessments about how much everyone is likely to play, and this would take ages to do as well. I’m open to suggestions for how to improve this.</p>
<p>With all these changes, the model now looks like this:</p>
<p><code>points | weights(weight) ~ player + opponent + home + minutes + (1 | mm(team_1, team_2))</code></p>
<p>(Eagle-eyed readers will note I’ve also dropped the spline for gameweek. I think having this plus the gameweek weighting is excessive, and it ups the run time.)</p>
<p>I tightened up the priors even more than last week, because I’m really keen for the model to be conservative with the extent it listens to over-performance. You’ll see that this is once again likely what is keeping Pukki from being higher up, although he’s still up there. I’ll probably run with these priors for a few more weeks and then loosen them up very slightly for the rest of the season. Keeping them tight also saves me so much time running the model, because it’s quicker when it has more informative priors. Like I said last week, if you think depending on the priors like this is pernicious, just don’t @ me. I don’t want to hear it. It’s <em>purely about <strong>skepticism</strong></em>. It’s not virtuous to blindly follow data where it leads.</p>
</div>
<div id="predictions" class="section level2 unnumbered">
<h2>Predictions</h2>
<p>Without further ado, all those changes give us the following top 25, first shown with the <code>fitted()</code> function, and then with <code>predict()</code>. I discussed the difference last week. I think <code>predict()</code> better reflects the overall degree of uncertainty in this stuff, but <code>fitted()</code> gives us a better idea of the variability in this certainty across players. Plus it looks prettier.</p>
<p><img src="images/gameweek_6_top25.png" style="width:100%; border:0px solid; margin-right: 20px" align="left"></p>
<p><br /></p>
<p><img src="images/gameweek_6_top25_p.png" style="width:100%; border:0px solid; margin-right: 20px" align="left"></p>
<p>So Agüero is top, wth Sterling second, which is likely to do with their comparably easy fixture (Watford rather than Chelsea). Surely City will score multiple goals against Watford. The model recognises this (sort of).</p>
<p>The third and fourth spot are still taken by Liverpool’s two big-hitters, though. And then there’s Pukki, ever-present near the top (but notice the wider credible interval). It will be interesting to see if he can keep this purple patch going. Other things to note include Auba breaking into the top ten, and Vardy staying up amongst it. It’s hard to argue with their consistency, and I think Auba at home is always a good choice.</p>
<p>Remember, the assumption here is that all these players play the same minutes as last week. This seemed the most sensible assumption for now, but I’m going to try to think of a more appropriate way to do it. I think Stones is out injured, but is in the top 25, which he obviously shouldn’t be. It might just be a case of manually setting problematic players to 0 minutes.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
